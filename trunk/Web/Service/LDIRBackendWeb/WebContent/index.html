<html>
<head>
</head>
<body>
<script type="text/javascript" src="./json.js"></script>
<script type="text/javascript" src="./wsclient.js"></script>
<script type="text/javascript">
var username='s';
var password='s';
var userid = '1';
</script>


<div id="registration_block">
<hr>
<h1>Registration</h1>
<script type="text/javascript">
function registerClick()
{
	json_object = json_from_form('registration');
	gen_req = sendRequest('post', 'http://localhost:8080/LDIRBackend/reg/ws',
			generic_insert_callback, json_object, false);
}
</script>

<form name="registration" id="registration">
	Firstname: <input type="text" size="20" name="firstName"> <br> 
	Lastname: <input type="text" size="20" name="lastName"> <br>
	Email: <input type="text" size="20" name="email"> <br>
	Town: <input type="text" size="20" name="town"> <br>
	County: <input type="text" size="20" name="county"> <br>
	Password: <input type="password" size="20" name="passwd"> <br>
	Phone: <input type="text" size="20" name="phone"> <br>
</form>
<input type="button" value="Register" onclick="registerClick()" >
</div>


<div id="login_block">
<hr>
<h1>Login</h1>
<script type="text/javascript">
var login_req;

function login_callback()
{
	if (login_req.readyState != 4)
		return;
	if (login_req.status != 200)
		alert('Unable to log in.');
	else {	
		userid = login_req.responseText;
		alert('Logged in!');
	}
	document.login.reset();
}

function loginClick()
{
	//json_object = json_from_form('registration');
	username = document.login.email.value;
	password = document.login.passwd.value;
	login_req = sendRequestString('get', 'http://localhost:8080/LDIRBackend/ws/user',
			login_callback, null, username, password);
}
</script>

<form name="login" id="login">
	Email: <input type="text" size="20" name="email"> <br>
	Password: <input type="password" size="20" name="passwd"> <br>
</form>
<input type="button" value="Login" onclick="loginClick()" >
</div>

<div id="new_organization_block">
<hr>
<h1>New organization</h1>
<script type="text/javascript">

function newOrgClick()
{
	json_object = json_from_form('new_organization');
	gen_req = sendRequest('post', 'http://localhost:8080/LDIRBackend/ws/organization',
			generic_insert_callback, json_object, false, username, password);
}
</script>

<form name="new_organization" id="new_organization">
	Name: <input type="text" size="20" name="name"> <br> 
	Address: <input type="text" size="20" name="address"> <br>
	Members count: <input type="text" size="20" name="membersCount"> <br>
	Town: <input type="text" size="20" name="town"> <br>
	County: <input type="text" size="20" name="county"> <br>
	Type: <select name="type">
	<option value="CITY_HALL">City hall</option>
	<option value="COMPANY">Company</option>
	<option value="LANDFILL">Landfill</option>
	<option value="REGISTRATION_POINT">Registration point</option>
	<option value="SCHOOL">School</option>
	</select> <br>
</form>
<input type="button" value="Register" onclick="newOrgClick()" >
</div>


<div id="edit_organization_block">
<hr>
<h1>Edit organization</h1>
<script type="text/javascript">
function editOrgClick()
{
	gen_form_reference = 'edit_organization';
	json_object = json_from_form(gen_form_reference);
	window.alert(generic_edit_id + json_object);
	gen_req = sendRequest('put', 'http://localhost:8080/LDIRBackend/ws/organization/' + generic_edit_id + '/',
			generic_insert_callback, json_object, false, username, password);
}

function deleteOrgClick()
{
	gen_req = sendRequest('delete', 'http://localhost:8080/LDIRBackend/ws/organization/' + generic_edit_id + '/',
			generic_insert_callback, null, false, username, password);
}

function fetchMyOrg()
{
	generic_select = 'organizations';
	generic_type = 'organization';
	generic_field_id = 'organizationId';
	generic_field_name = 'name';
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/user/' + userid +'/organizations',
			generic_select_callback, null, true, username, password);
}

function displayOrganization()
{
	gen_form_reference = 'edit_organization';
	opt = document.getElementById('organizations');
	generic_edit_id = opt.options[opt.selectedIndex].value;
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/organization/' + generic_edit_id,
			generic_load_callback, null, true, username, password);
}

function orgSearchTeam()
{
	teamName = encodeURI(document.forms.user_team_search.teamName.value);
	
	generic_select = 'org_found_teams';
	generic_type = 'team';
	generic_field_id = 'teamId';
	generic_field_name = 'teamName';
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/team/nameSearch/?teamName=' + teamName,
			generic_select_callback, null, true, username, password);
}

function orgJoinTeamClick()
{
	var team = {};
	teamForm = document.getElementById('org_found_teams');
	teamId = teamForm.options[teamForm.selectedIndex].value;
	team['teamId'] = teamId;
	teamJSON = JSON.stringify(team);
	orgSelect = document.getElementById('organizations');
	organizationId = orgSelect.options[orgSelect.selectedIndex].value;
	gen_form_reference = null;
	gen_req = sendRequest('post', 'http://localhost:8080/LDIRBackend/ws/organization/' + organizationId + '/team',
			generic_insert_callback, teamJSON, true, username, password);
}
</script>
<input type="button" value="Fetch my organizations" onclick="fetchMyOrg()">

<form name="my_organizations">
<select name="organizations" id="organizations"></select>
</form>

<form name="org_team_search">
	Team name: <input type="text" size="20" name="teamName"> <br> 
</form>
<input type="button" value="Search team" onclick="orgSearchTeam()">

<form name="org_found_teams">
	Found teams: <select name="org_found_teams" id="org_found_teams"></select>
</form>
<input type="button" value="Join" onclick="orgJoinTeamClick()">

<input type="button" value="Edit organizations" onclick="displayOrganization()">

<form name="edit_organization" id="edit_organization">
	Name: <input type="text" size="20" name="name"> <br> 
	Address: <input type="text" size="20" name="address"> <br>
	Members count: <input type="text" size="20" name="membersCount"> <br>
	Town: <input type="text" size="20" name="town"> <br>
	County: <input type="text" size="20" name="county"> <br>
	Type: <select name="type">
	<option value="CITY_HALL">City hall</option>
	<option value="COMPANY">Company</option>
	<option value="LANDFILL">Landfill</option>
	<option value="REGISTRATION_POINT">Registration point</option>
	<option value="SCHOOL">School</option>
	</select> <br>
</form>
<input type="button" value="Update" onclick="editOrgClick()" >
<input type="button" value="Delete" onclick="deleteOrgClick()" >
</div>

<div id="new_team_block">
<hr>
<h1>New team</h1>
<script type="text/javascript">
function newTeamClick()
{
	json_object = json_from_form('new_team');
	gen_req = sendRequest('post', 'http://localhost:8080/LDIRBackend/ws/team',
			generic_insert_callback, json_object, false, username, password);
}
</script>

<form name="new_team" id="new_team">
	Name: <input type="text" size="20" name="teamName"> <br> 
</form>
<input type="button" value="Register" onclick="newTeamClick()" >
</div>

<div id="edit_team_block">
<hr>
<h1>Edit my teams</h1>
<script type="text/javascript">
function editTeamClick()
{
	json_object = json_from_form('edit_team');
	gen_req = sendRequest('put', 'http://localhost:8080/LDIRBackend/ws/team',
			generic_insert_callback, json_object, false, username, password);
}
function editOrgClick()
{
	gen_form_reference = 'edit_organization';
	json_object = json_from_form(gen_form_reference);
	window.alert(generic_edit_id + json_object);
	gen_req = sendRequest('put', 'http://localhost:8080/LDIRBackend/ws/organization/' + generic_edit_id + '/',
			generic_insert_callback, json_object, false, username, password);
}

function deleteTeamClick()
{
	gen_req = sendRequest('delete', 'http://localhost:8080/LDIRBackend/ws/team/' + generic_edit_id + '/',
			generic_insert_callback, null, false, username, password);
}

function fetchMyTeams()
{
	generic_select = 'my_teams';
	generic_type = 'team';
	generic_field_id = 'teamId';
	generic_field_name = 'teamName';
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/user/' + userid +'/managedTeams',
			generic_select_callback, null, true, username, password);
}

function displayTeam()
{
	gen_form_reference = 'edit_team';
	opt = document.getElementById('my_teams');
	generic_edit_id = opt.options[opt.selectedIndex].value;
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/team/' + generic_edit_id,
			generic_load_callback, null, true, username, password);
}

function loadTeamMembers()
{
	generic_select = 'user_team_members';
	generic_type = 'user';
	generic_field_id = 'userId';
	generic_field_name = 'email';
	opt = document.getElementById('my_teams');
	generic_edit_id = opt.options[opt.selectedIndex].value;
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/team/' + generic_edit_id +'/volunteerMembers',
			generic_select_callback, null, true, username, password);
}

function withdrawTeamMember()
{
	opt = document.getElementById('user_team_members');
	user_id = opt.options[opt.selectedIndex].value;
	gen_req = sendRequest('delete', 'http://localhost:8080/LDIRBackend/ws/team/' + generic_edit_id + '/volunteer/' + user_id,
			generic_insert_callback, null, false, username, password);
}

function loadOrgTeamMembers()
{
	generic_select = 'org_team_members';
	generic_type = 'organization';
	generic_field_id = 'organizationId';
	generic_field_name = 'name';
	opt = document.getElementById('my_teams');
	generic_edit_id = opt.options[opt.selectedIndex].value;
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/team/' + generic_edit_id +'/organizationMembers',
			generic_select_callback, null, true, username, password);
}

function withdrawOrgTeamMember()
{
	opt = document.getElementById('org_team_members');
	org_id = opt.options[opt.selectedIndex].value;
	gen_req = sendRequest('delete', 'http://localhost:8080/LDIRBackend/ws/team/' + generic_edit_id + '/organization/' + org_id,
			generic_insert_callback, null, false, username, password);
}

function addGPS()
{
	opt = document.getElementById('my_teams');
	generic_edit_id = opt.options[opt.selectedIndex].value;
	gps_json = json_from_form('add_gps_equipment');
	window.alert(gps_json);
	gen_req = sendRequest('put', 'http://localhost:8080/LDIRBackend/ws/team/' + generic_edit_id + '/gps',
			generic_insert_callback, gps_json, false, username, password);
}
</script>
<input type="button" value="Fetch my teams" onclick="fetchMyTeams()">

<form name="my_teams">
	My teams: <select name="my_teams" id="my_teams"></select>
</form>

<form name="user_team_members">
	Volunteer members: <select name="user_team_members" id="user_team_members"></select>
</form>
<input type="button" value="Load volunteer members" onclick="loadTeamMembers()">
<input type="button" value="Withdraw volunteer member" onclick="withdrawTeamMember()">

<form name="org_team_members">
	Organization members: <select name="org_team_members" id="org_team_members"></select>
</form>
<input type="button" value="Load organization members" onclick="loadOrgTeamMembers()">
<input type="button" value="Withdraw organization member" onclick="withdrawOrgTeamMember()">

<form name="add_gps_equipment" id="add_gps_equipment">
	GPS count: <input type="text" size="20" name="count">
</form>
<input type="button" value="Add GPS" onClick="addGPS()">

<input type="button" value="Edit team" onclick="displayTeam()">

<form name="edit_team" id="edit_team">
	Team name: <input type="text" size="20" name="teamName"> <br> 
</form>
<input type="button" value="Register" onclick="editTeamClick()" >
<input type="button" value="Delete" onclick="deleteTeamClick()" >
</div>

<div id="user_enroll_team">
<hr>
<h1>Enroll in team</h1>
<script type="text/javascript">
function userSearchTeam()
{
	teamName = encodeURI(document.forms.user_team_search.teamName.value);
	
	generic_select = 'user_found_teams';
	generic_type = 'team';
	generic_field_id = 'teamId';
	generic_field_name = 'teamName';
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/team/nameSearch/?teamName=' + teamName,
			generic_select_callback, null, true, username, password);
}

function userJoinTeamClick()
{
	var team = {};
	teamForm = document.getElementById('user_found_teams');
	teamId = teamForm.options[teamForm.selectedIndex].value;
	team['teamId'] = teamId;
	teamJSON = JSON.stringify(team);
	gen_form_reference = null;
	gen_req = sendRequest('post', 'http://localhost:8080/LDIRBackend/ws/user/' + userid + '/team',
			generic_insert_callback, teamJSON, true, username, password);
}
</script>

<form name="user_team_search">
	Team name: <input type="text" size="20" name="teamName"> <br> 
</form>
<input type="button" value="Search team" onclick="userSearchTeam()">

<form name="user_found_teams">
	Found teams: <select name="user_found_teams" id="user_found_teams"></select>
</form>
<input type="button" value="Join" onclick="userJoinTeamClick()">

</div>

<div id="update_user">
<hr>
<h1>Set user role</h1>
<script type="text/javascript">
function searchUser()
{
	user_email = encodeURI(document.forms.user_search.email.value);
	
	generic_select = 'found_users';
	generic_type = 'user';
	generic_field_id = 'userId';
	generic_field_name = 'email';
	gen_req = sendRequest('get', 'http://localhost:8080/LDIRBackend/ws/user/emailSearch/?email=' + user_email,
			generic_select_callback, null, true, username, password);
}

function updateRole()
{
	userForm = document.getElementById('found_users');
	user_tochange = userForm.options[userForm.selectedIndex].value;	
	var role = document.getElementById('user_set_role').value;
	gen_form_reference = null;
	gen_req = sendRequest('put', 'http://localhost:8080/LDIRBackend/ws/user/' + user_tochange + '/role',
			generic_insert_callback, role, true, username, password);
}
</script>

<form name="user_search">
	Email: <input type="text" size="20" name="email"> <br> 
</form>
<input type="button" value="Search user" onclick="searchUser()">

<form name="found_users">
	Found users: <select name="found_users" id="found_users"></select>
</form>

<form name="user_set_role">
	Set role:
	<select name="user_set_role" id="user_set_role">
		<option value="PENDING">user must confirm its email</option>
		<option value="SUSPENDED">suspend user</option>
		<option value="ADMIN">administrator</option>
		<option value="ORGANIZER">organizer</option>
		<option value="ORGANIZER_MULTI">organizer with multiple teams</option>
		<option value="VOLUNTEER">volunteer</option>
		<option value="VOLUNTEER_MULTI">volunteer with multiple teams</option>
	</select>
</form>
<input type="button" value="Update role" onclick="updateRole()">

</div>


</body>
</html>